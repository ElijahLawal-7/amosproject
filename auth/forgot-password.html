<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - Greenland Bounty Investment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../assets/css/main.css" rel="stylesheet">
    <link href="../assets/css/auth.css" rel="stylesheet">
    <link href="../assets/css/responsive.css" rel="stylesheet">
</head>
<body class="auth-body">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success fixed-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="../index.html">
                <i class="fas fa-seedling me-2"></i>
                <span class="brand-text">Greenland Bounty</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="login.html">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="signup.html">Sign Up</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="auth-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-5 col-md-7 col-sm-9">
                    <div class="auth-card">
                        <div class="auth-header text-center">
                            <div class="auth-logo">
                                <i class="fas fa-key"></i>
                            </div>
                            <h2>Reset Password</h2>
                            <p class="text-muted">Enter your email or phone number to receive a reset code</p>
                        </div>

                        <!-- Password Reset Form -->
                        <form id="forgotPasswordForm" class="auth-form">
                            <!-- Reset Method Toggle -->
                            <div class="reset-toggle mb-4">
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="resetMethod" id="emailReset" value="email" checked>
                                    <label class="btn btn-outline-success" for="emailReset">
                                        <i class="fas fa-envelope me-1"></i> Email
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="resetMethod" id="phoneReset" value="phone">
                                    <label class="btn btn-outline-success" for="phoneReset">
                                        <i class="fas fa-phone me-1"></i> Phone
                                    </label>
                                </div>
                            </div>

                            <!-- Email Reset Fields -->
                            <div id="emailResetFields">
                                <div class="form-group mb-3">
                                    <label for="email" class="form-label">Email Address</label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-envelope"></i>
                                        </span>
                                        <input type="email" class="form-control" id="email" name="email" 
                                               placeholder="Enter your registered email" required>
                                    </div>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>

                            <!-- Phone Reset Fields -->
                            <div id="phoneResetFields" style="display: none;">
                                <div class="form-group mb-3">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-phone"></i>
                                        </span>
                                        <input type="tel" class="form-control" id="phone" name="phone" 
                                               placeholder="Enter your registered phone number">
                                    </div>
                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-success btn-lg w-100 mb-3" id="resetBtn">
                                <span class="btn-text">Send Reset Code</span>
                                <span class="btn-spinner spinner-border spinner-border-sm d-none" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </span>
                            </button>

                            <!-- Error Message -->
                            <div id="resetError" class="alert alert-danger d-none" role="alert">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <span id="resetErrorMessage"></span>
                            </div>

                            <!-- Success Message -->
                            <div id="resetSuccess" class="alert alert-success d-none" role="alert">
                                <i class="fas fa-check-circle me-2"></i>
                                <span id="resetSuccessMessage"></span>
                            </div>
                        </form>

                        <!-- OTP Verification Form (Initially Hidden) -->
                        <form id="otpVerificationForm" class="auth-form d-none">
                            <div class="text-center mb-4">
                                <h4>Enter Verification Code</h4>
                                <p class="text-muted">We've sent a 6-digit code to <span id="sentTo"></span></p>
                            </div>

                            <div class="form-group mb-3">
                                <label for="otpCode" class="form-label">Verification Code</label>
                                <div class="otp-input-group">
                                    <input type="text" class="form-control otp-input" maxlength="1" id="otp1">
                                    <input type="text" class="form-control otp-input" maxlength="1" id="otp2">
                                    <input type="text" class="form-control otp-input" maxlength="1" id="otp3">
                                    <input type="text" class="form-control otp-input" maxlength="1" id="otp4">
                                    <input type="text" class="form-control otp-input" maxlength="1" id="otp5">
                                    <input type="text" class="form-control otp-input" maxlength="1" id="otp6">
                                </div>
                                <div class="invalid-feedback"></div>
                            </div>

                            <!-- Resend Code -->
                            <div class="text-center mb-3">
                                <span class="text-muted">Didn't receive the code?</span>
                                <button type="button" class="btn btn-link p-0 ms-1" id="resendCodeBtn">
                                    Resend Code
                                </button>
                                <div id="resendTimer" class="text-muted small mt-1" style="display: none;">
                                    Resend in <span id="timerCount">60</span> seconds
                                </div>
                            </div>

                            <!-- Verify Button -->
                            <button type="submit" class="btn btn-success btn-lg w-100 mb-3" id="verifyBtn">
                                <span class="btn-text">Verify Code</span>
                                <span class="btn-spinner spinner-border spinner-border-sm d-none" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </span>
                            </button>

                            <!-- Error Message -->
                            <div id="verifyError" class="alert alert-danger d-none" role="alert">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <span id="verifyErrorMessage"></span>
                            </div>
                        </form>

                        <!-- New Password Form (Initially Hidden) -->
                        <form id="newPasswordForm" class="auth-form d-none">
                            <div class="text-center mb-4">
                                <h4>Create New Password</h4>
                                <p class="text-muted">Enter your new password below</p>
                            </div>

                            <div class="form-group mb-3">
                                <label for="newPassword" class="form-label">New Password</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-lock"></i>
                                    </span>
                                    <input type="password" class="form-control" id="newPassword" name="newPassword" 
                                           placeholder="Enter new password" required>
                                    <button class="btn btn-outline-secondary password-toggle" type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback"></div>
                                <div class="password-strength mt-2">
                                    <div class="progress" style="height: 4px;">
                                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                    </div>
                                    <small class="text-muted">Password strength: <span id="strengthText">Weak</span></small>
                                </div>
                            </div>

                            <div class="form-group mb-3">
                                <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-lock"></i>
                                    </span>
                                    <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" 
                                           placeholder="Confirm new password" required>
                                    <button class="btn btn-outline-secondary password-toggle" type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback"></div>
                            </div>

                            <!-- Password Requirements -->
                            <div class="password-requirements mb-3">
                                <small class="text-muted">Password must contain:</small>
                                <ul class="list-unstyled small">
                                    <li id="length-req"><i class="fas fa-times text-danger"></i> At least 8 characters</li>
                                    <li id="uppercase-req"><i class="fas fa-times text-danger"></i> One uppercase letter</li>
                                    <li id="lowercase-req"><i class="fas fa-times text-danger"></i> One lowercase letter</li>
                                    <li id="number-req"><i class="fas fa-times text-danger"></i> One number</li>
                                    <li id="special-req"><i class="fas fa-times text-danger"></i> One special character</li>
                                </ul>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-success btn-lg w-100 mb-3" id="updatePasswordBtn">
                                <span class="btn-text">Update Password</span>
                                <span class="btn-spinner spinner-border spinner-border-sm d-none" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </span>
                            </button>

                            <!-- Error Message -->
                            <div id="passwordError" class="alert alert-danger d-none" role="alert">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <span id="passwordErrorMessage"></span>
                            </div>

                            <!-- Success Message -->
                            <div id="passwordSuccess" class="alert alert-success d-none" role="alert">
                                <i class="fas fa-check-circle me-2"></i>
                                <span>Password updated successfully! Redirecting to login...</span>
                            </div>
                        </form>

                        <!-- Back to Login Link -->
                        <div class="auth-footer text-center">
                            <p class="mb-0">
                                <a href="login.html" class="back-link">
                                    <i class="fas fa-arrow-left me-1"></i>
                                    Back to Login
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="auth-footer-bottom bg-dark text-light py-3">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2024 Greenland Bounty Investment. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="social-links">
                        <a href="#" class="text-light me-3"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-light me-3"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-light me-3"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-light"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="../assets/js/validation.js"></script>
    <script src="../assets/js/auth.js"></script>
    
    <script>
        // Initialize forgot password functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Form elements
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            const otpVerificationForm = document.getElementById('otpVerificationForm');
            const newPasswordForm = document.getElementById('newPasswordForm');
            
            // Toggle elements
            const resetMethodRadios = document.querySelectorAll('input[name="resetMethod"]');
            const emailFields = document.getElementById('emailResetFields');
            const phoneFields = document.getElementById('phoneResetFields');
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            
            // OTP elements
            const otpInputs = document.querySelectorAll('.otp-input');
            const resendBtn = document.getElementById('resendCodeBtn');
            const resendTimer = document.getElementById('resendTimer');
            const timerCount = document.getElementById('timerCount');
            
            // Password elements
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const passwordToggles = document.querySelectorAll('.password-toggle');
            
            let resendCountdown;
            let currentStep = 1; // 1: Reset, 2: OTP, 3: New Password
            
            // Toggle reset method
            resetMethodRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'email') {
                        emailFields.style.display = 'block';
                        phoneFields.style.display = 'none';
                        emailInput.required = true;
                        phoneInput.required = false;
                        phoneInput.value = '';
                    } else {
                        emailFields.style.display = 'none';
                        phoneFields.style.display = 'block';
                        phoneInput.required = true;
                        emailInput.required = false;
                        emailInput.value = '';
                    }
                });
            });
            
            // Password toggle functionality
            passwordToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const input = this.parentNode.querySelector('input');
                    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                    input.setAttribute('type', type);
                    
                    const icon = this.querySelector('i');
                    icon.classList.toggle('fa-eye');
                    icon.classList.toggle('fa-eye-slash');
                });
            });
            
            // OTP input handling
            otpInputs.forEach((input, index) => {
                input.addEventListener('input', function() {
                    if (this.value.length === 1 && index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    }
                });
                
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && this.value === '' && index > 0) {
                        otpInputs[index - 1].focus();
                    }
                });
            });
            
            // Password strength checker
            if (newPasswordInput) {
                newPasswordInput.addEventListener('input', function() {
                    checkPasswordStrength(this.value);
                    validatePasswordRequirements(this.value);
                });
            }
            
            // Confirm password validation
            if (confirmPasswordInput) {
                confirmPasswordInput.addEventListener('input', function() {
                    validatePasswordMatch();
                });
            }
            
            // Step 1: Send reset code
            forgotPasswordForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const resetBtn = document.getElementById('resetBtn');
                const btnText = resetBtn.querySelector('.btn-text');
                const btnSpinner = resetBtn.querySelector('.btn-spinner');
                const errorDiv = document.getElementById('resetError');
                const successDiv = document.getElementById('resetSuccess');
                const errorMessage = document.getElementById('resetErrorMessage');
                const successMessage = document.getElementById('resetSuccessMessage');
                
                // Clear previous messages
                errorDiv.classList.add('d-none');
                successDiv.classList.add('d-none');
                
                // Show loading state
                resetBtn.disabled = true;
                btnText.textContent = 'Sending...';
                btnSpinner.classList.remove('d-none');
                
                const resetMethod = document.querySelector('input[name="resetMethod"]:checked').value;
                const contactValue = resetMethod === 'email' ? emailInput.value : phoneInput.value;
                
                // Validate input
                if (!contactValue.trim()) {
                    showError(errorDiv, errorMessage, `${resetMethod === 'email' ? 'Email' : 'Phone'} is required`);
                    resetButtonState(resetBtn, btnText, btnSpinner, 'Send Reset Code');
                    return;
                }
                
                try {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Show success and move to OTP step
                    successMessage.textContent = `Reset code sent to ${contactValue}`;
                    successDiv.classList.remove('d-none');
                    
                    setTimeout(() => {
                        showOTPForm(contactValue);
                    }, 1500);
                    
                } catch (error) {
                    showError(errorDiv, errorMessage, 'Failed to send reset code. Please try again.');
                    resetButtonState(resetBtn, btnText, btnSpinner, 'Send Reset Code');
                }
            });
            
            // Step 2: Verify OTP
            otpVerificationForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const verifyBtn = document.getElementById('verifyBtn');
                const btnText = verifyBtn.querySelector('.btn-text');
                const btnSpinner = verifyBtn.querySelector('.btn-spinner');
                const errorDiv = document.getElementById('verifyError');
                const errorMessage = document.getElementById('verifyErrorMessage');
                
                // Get OTP value
                const otpValue = Array.from(otpInputs).map(input => input.value).join('');
                
                if (otpValue.length !== 6) {
                    showError(errorDiv, errorMessage, 'Please enter the complete 6-digit code');
                    return;
                }
                
                // Clear previous messages
                errorDiv.classList.add('d-none');
                
                // Show loading state
                verifyBtn.disabled = true;
                btnText.textContent = 'Verifying...';
                btnSpinner.classList.remove('d-none');
                
                try {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Move to new password step
                    showNewPasswordForm();
                    
                } catch (error) {
                    showError(errorDiv, errorMessage, 'Invalid code. Please try again.');
                    resetButtonState(verifyBtn, btnText, btnSpinner, 'Verify Code');
                }
            });
            
            // Step 3: Update password
            newPasswordForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const updateBtn = document.getElementById('updatePasswordBtn');
                const btnText = updateBtn.querySelector('.btn-text');
                const btnSpinner = updateBtn.querySelector('.btn-spinner');
                const errorDiv = document.getElementById('passwordError');
                const successDiv = document.getElementById('passwordSuccess');
                const errorMessage = document.getElementById('passwordErrorMessage');
                
                // Validate passwords
                if (!validatePasswordRequirements(newPasswordInput.value)) {
                    showError(errorDiv, errorMessage, 'Password does not meet requirements');
                    return;
                }
                
                if (!validatePasswordMatch()) {
                    showError(errorDiv, errorMessage, 'Passwords do not match');
                    return;
                }
                
                // Clear previous messages
                errorDiv.classList.add('d-none');
                successDiv.classList.add('d-none');
                
                // Show loading state
                updateBtn.disabled = true;
                btnText.textContent = 'Updating...';
                btnSpinner.classList.remove('d-none');
                
                try {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Show success and redirect
                    successDiv.classList.remove('d-none');
                    
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                    
                } catch (error) {
                    showError(errorDiv, errorMessage, 'Failed to update password. Please try again.');
                    resetButtonState(updateBtn, btnText, btnSpinner, 'Update Password');
                }
            });
            
            // Resend code functionality
            resendBtn.addEventListener('click', function() {
                startResendTimer();
                // Simulate resend API call
                setTimeout(() => {
                    alert('New code sent!');
                }, 1000);
            });
            
            // Helper functions
            function showOTPForm(contactValue) {
                forgotPasswordForm.classList.add('d-none');
                otpVerificationForm.classList.remove('d-none');
                document.getElementById('sentTo').textContent = contactValue;
                otpInputs[0].focus();
                currentStep = 2;
            }
            
            function showNewPasswordForm() {
                otpVerificationForm.classList.add('d-none');
                newPasswordForm.classList.remove('d-none');
                newPasswordInput.focus();
                currentStep = 3;
            }
            
            function showError(errorDiv, errorMessage, message) {
                errorMessage.textContent = message;
                errorDiv.classList.remove('d-none');
            }
            
            function resetButtonState(btn, btnText, btnSpinner, originalText) {
                btn.disabled = false;
                btnText.textContent = originalText;
                btnSpinner.classList.add('d-none');
            }
            
            function checkPasswordStrength(password) {
                const progressBar = document.querySelector('.progress-bar');
                const strengthText = document.getElementById('strengthText');
                
                let score = 0;
                if (password.length >= 8) score++;
                if (/[A-Z]/.test(password)) score++;
                if (/[a-z]/.test(password)) score++;
                if (/[0-9]/.test(password)) score++;
                if (/[^A-Za-z0-9]/.test(password)) score++;
                
                const percentage = (score / 5) * 100;
                progressBar.style.width = percentage + '%';
                
                if (score <= 2) {
                    progressBar.className = 'progress-bar bg-danger';
                    strengthText.textContent = 'Weak';
                } else if (score <= 3) {
                    progressBar.className = 'progress-bar bg-warning';
                    strengthText.textContent = 'Fair';
                } else if (score <= 4) {
                    progressBar.className = 'progress-bar bg-info';
                    strengthText.textContent = 'Good';
                } else {
                    progressBar.className = 'progress-bar bg-success';
                    strengthText.textContent = 'Strong';
                }
            }
            
            function validatePasswordRequirements(password) {
                const requirements = {
                    'length-req': password.length >= 8,
                    'uppercase-req': /[A-Z]/.test(password),
                    'lowercase-req': /[a-z]/.test(password),
                    'number-req': /[0-9]/.test(password),
                    'special-req': /[^A-Za-z0-9]/.test(password)
                };
                
                let allMet = true;
                
                Object.keys(requirements).forEach(reqId => {
                    const reqElement = document.getElementById(reqId);
                    const icon = reqElement.querySelector('i');
                    
                    if (requirements[reqId]) {
                        icon.className = 'fas fa-check text-success';
                    } else {
                        icon.className = 'fas fa-times text-danger';
                        allMet = false;
                    }
                });
                
                return allMet;
            }
            
            function validatePasswordMatch() {
                const match = newPasswordInput.value === confirmPasswordInput.value;
                
                if (confirmPasswordInput.value && !match) {
                    confirmPasswordInput.classList.add('is-invalid');
                    const feedback = confirmPasswordInput.parentNode.nextElementSibling;
                    if (feedback) feedback.textContent = 'Passwords do not match';
                } else {
                    confirmPasswordInput.classList.remove('is-invalid');
                }
                
                return match;
            }
            
            function startResendTimer() {
                let timeLeft = 60;
                resendBtn.disabled = true;
                resendTimer.style.display = 'block';
                
                resendCountdown = setInterval(() => {
                    timeLeft--;
                    timerCount.textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        clearInterval(resendCountdown);
                        resendBtn.disabled = false;
                        resendTimer.style.display = 'none';
                    }
                }, 1000);
            }
        });
    </script>
</body>
</html>